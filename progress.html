<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Progress | Physics for Noobs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Jost:wght@300;400;500;600;700&family=Delius&family=Nova+Square&family=Yatra+One&family=Quintessential&family=Cabin+Sketch:wght@400;700&family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&family=Andika:wght@400;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/achievements.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#050510">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="images/icon-192.svg">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”¬</text></svg>">
  <script src="js/theme.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script defer src="js/firebase-config.js"></script>
  <script defer src="js/auth.js"></script>
  <script defer src="js/ranking.js"></script>
  <script defer src="js/achievements-config.js"></script>
</head>
<body>

  <div class="splash-screen" id="splash"><div class="splash-rocket"><div class="sp-nose"></div><div class="sp-body"></div><div class="sp-window"></div><div class="sp-fin-l"></div><div class="sp-fin-r"></div><div class="sp-flame"></div><div class="sp-glow"></div></div><div class="splash-logo"><span class="brand-initial">P</span>hysics <span class="brand-accent">for Noobs</span></div><div class="splash-tagline">Free Therapy For Physics Trauma</div></div>
<div class="bg-grid"></div>

  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="nav-logo" id="nav-logo">
        <div class="logo-icon">
          <div class="logo-pendulum"><div class="pendulum-pivot"></div><div class="pendulum-arm"><div class="pendulum-string"></div><div class="pendulum-bob"></div></div></div>
        </div>
        <div class="logo-text">
          <span class="brand-name"><span class="brand-initial">P</span>hysics <span class="brand-accent">for Noobs</span></span>
          <span class="brand-tag">FREE THERAPY FOR PHYSICS TRAUMA</span>
        </div>
      </a>

      <div class="nav-links">
        <div class="nav-item">
          <a href="index.html" class="nav-link">Home</a>
        </div>
        <div class="nav-item">
          <a href="about.html" class="nav-link">About Me</a>
        </div>
        <div class="nav-item"><a href="#" class="nav-link">Chapters</a><div class="dropdown"><a href="chapters.html"><div class="dd-icon">&#128214;</div> Theory</a><a href="slides.html"><div class="dd-icon">&#127916;</div> Slides</a></div></div>        <div class="nav-item">
          <a href="simulations.html" class="nav-link">Simulations</a>
        </div>
        <div class="nav-item">
          <a href="tests.html" class="nav-link">Tests</a>
        </div>
        <div class="nav-item">
          <a href="flashcards.html" class="nav-link">Flashcards</a>
        </div>
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme"></button>

        <button class="auth-btn" id="auth-login-btn">
          <svg class="google-icon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Sign in
        </button>

        <a href="progress.html" class="mobile-auth-action" id="mobile-progress-btn" style="display:none;">Progress</a>
        <button class="mobile-auth-action mobile-signout-btn" id="mobile-signout-btn" style="display:none;">Sign Out</button>

        <div class="user-menu nav-item" id="auth-user-menu" style="display:none;">
          <img class="user-avatar" id="auth-user-avatar" src="" alt="User">
          <span class="user-rank-badge rank-bronze" id="auth-rank-badge"><span class="rank-icon" id="auth-rank-icon"></span><span id="auth-rank-label"></span></span>
          <div class="dropdown"><div class="dropdown-rank" id="dropdown-rank-display"><span class="rank-tier" id="dropdown-rank-tier"></span><div class="rank-progress-bar"><div class="rank-progress-fill" id="dropdown-rank-fill"></div></div></div>
            <a href="progress.html"><div class="dd-icon">&#128200;</div> My Progress</a>
            <div class="dropdown-divider"></div>
            <a href="#" id="auth-logout-btn"><div class="dd-icon">&#128682;</div> Sign Out</a>
          </div>
        </div>

      </div>

      <button class="nav-toggle" aria-label="Menu">
        <span></span><span></span><span></span>
      </button>
    </div>
  </nav>
  <script>
    (function(){
      var s=document.getElementById('splash');
      if(sessionStorage.getItem('ae-splash')){s.style.display='none';}
      else{
        sessionStorage.setItem('ae-splash','1');setTimeout(function(){s.classList.add('fade-out');},2200);setTimeout(function(){s.style.display='none';},2700);
      }
    })();
  </script>

  <div class="page-header">
    <h1>My <span class="text-gradient">Progress</span></h1>
    <p>Track your simulation usage and study time</p>
  </div>

  <section class="section" style="padding-top: 20px;">
    <div class="container">

      <div id="progress-login-prompt" class="login-prompt" style="display:none;">
        <h2>Sign in to Track Progress</h2>
        <p>Log in with Google to see your simulation history, visit counts, and time spent studying.</p>
        <button class="auth-btn" id="progress-login-btn">
          <svg class="google-icon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Sign in with Google
        </button>
      </div>

      <div id="progress-dashboard" style="display:none;">
        <div id="progress-student-name" style="text-align:center;margin-bottom:12px;display:none;">
          <span style="font-family:var(--font-display);font-size:1.1rem;color:var(--text-primary);font-weight:600;" id="progress-sname"></span>
          <span id="progress-batch" style="font-size:0.72rem;background:rgba(0,212,255,0.1);color:var(--color-primary);padding:2px 8px;border-radius:4px;margin-left:8px;font-weight:600;display:none;"></span>
        </div>
        <div class="summary-cards" id="summary-cards"></div>

        <div class="progress-tabs">
          <button class="progress-tab active" data-target="progress-sims">Simulations</button>
          <button class="progress-tab" data-target="progress-tests">Tests</button>
          <button class="progress-tab" data-target="progress-flashcards">Flashcards</button>
        </div>

        <div class="progress-tab-content active" id="progress-sims">
          <div class="progress-controls">
            <div class="pc-group">
              <span class="pc-label">Sort:</span>
              <button class="pc-btn active" data-sort="lastVisited">Last Visited</button>
              <button class="pc-btn" data-sort="mostVisited">Most Visited</button>
              <button class="pc-btn" data-sort="mostTime">Most Time</button>
              <button class="pc-btn" data-sort="completion">Completion</button>
            </div>
            <div class="pc-group">
              <span class="pc-label">Filter:</span>
              <button class="pc-btn active" data-filter="all">All</button>
              <button class="pc-btn" data-filter="mastered">Mastered</button>
              <button class="pc-btn" data-filter="incomplete">Incomplete</button>
            </div>
          </div>
          <div class="progress-header-row" id="progress-header-row">
            <span class="ph-sim">Simulation</span>
            <span class="ph-stat">Visits</span>
            <span class="ph-stat">Time</span>
            <span class="ph-stat">Last Visited</span>
            <span class="ph-ach">Discoveries</span>
          </div>
          <div class="progress-list" id="progress-list"></div>
          <p id="no-data-msg" style="text-align:center; color:var(--text-muted); display:none; margin-top: 40px;">
            No simulations visited yet. <a href="simulations.html" style="color:var(--color-primary);">Start exploring!</a>
          </p>
        </div>

        <div class="progress-tab-content" id="progress-tests">
          <div class="progress-coming-soon">
            <span>ðŸ§ª</span>
            <p>Tests coming soon</p>
          </div>
        </div>

        <div class="progress-tab-content" id="progress-flashcards">
          <div class="progress-list" id="flashcard-progress-list"></div>
          <p id="no-flashcard-msg" style="text-align:center; color:var(--text-muted); display:none; margin-top:40px;">
            No flashcard progress yet. <a href="flashcards.html" style="color:var(--color-primary);">Start studying!</a>
          </p>
        </div>

        <div id="reset-ach-wrap" style="display:none; margin-top: 40px; text-align: center;">
          <button id="reset-ach-btn" style="padding: 10px 24px; font-family: var(--font-body); font-size: 0.9rem; font-weight: 600; color: #ff4a6e; background: rgba(255,74,110,0.08); border: 1px solid rgba(255,74,110,0.3); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;">Reset All Achievements</button>
        </div>
      </div>

    </div>
  </section>

  <footer class="footer">
    <div class="footer-grid">
      <div class="footer-brand">
        <a href="index.html" class="nav-logo" style="margin-bottom: 16px;">
          <div class="logo-icon">
            <div class="logo-pendulum"><div class="pendulum-pivot"></div><div class="pendulum-arm"><div class="pendulum-string"></div><div class="pendulum-bob"></div></div></div>
          </div>
          <div class="logo-text">
            <span class="brand-name"><span class="brand-initial">P</span>hysics <span class="brand-accent">for Noobs</span></span>
            <span class="brand-tag">FREE THERAPY FOR PHYSICS TRAUMA</span>
          </div>
        </a>
        <p>Transforming physics education through interactive simulations, crystal-clear concepts, and a passion that ignites curiosity.</p>
      </div>
      <div class="footer-col">
        <h4>Resources</h4>
        <a href="chapters.html">Chapters</a>


        <a href="simulations.html">Simulations</a>
      </div>
      <div class="footer-col">
        <h4>Grade XI</h4>
        <a href="chapters.html#grade-xi">Kinematics</a>
        <a href="chapters.html#grade-xi">Newton's Laws</a>
        <a href="chapters.html#grade-xi">Work, Power, Energy</a>
        <a href="chapters.html#grade-xi">Thermodynamics</a>
        <a href="chapters.html#grade-xi">SHM & Waves</a>
      </div>
      <div class="footer-col">
        <h4>Grade XII</h4>
        <a href="chapters.html#grade-xii">Electrostatics</a>
        <a href="chapters.html#grade-xii">Current Electricity</a>
        <a href="chapters.html#grade-xii">Magnetism</a>
        <a href="chapters.html#grade-xii">Ray Optics</a>
        <a href="chapters.html#grade-xii">Modern Physics</a>
      </div>
    </div>
    <div class="footer-bottom">
      <span>&copy; 2025 Physics for Noobs &mdash; Sankaracharya Dutta. All rights reserved.</span>
      <span>Built with &#9889; for Physics lovers</span>
    </div>
  </footer>

  <script src="js/main.js"></script>
  <script>
    (function() {
      /* â”€â”€ Emoji map for each simulation â”€â”€ */
      var SIM_EMOJI_MAP = {
        'kinematics': '\uD83C\uDFAF', 'vector-addition': '\uD83E\uDDED', 'boat-river': '\u26F5',
        'graphical-analysis': '\uD83D\uDCCA', 'newtons-laws': '\uD83D\uDCA5', 'static-kinetic-friction': '\uD83E\uDDF1',
        'pulley-wire-constraint': '\u2699\uFE0F', 'wire-ring-constraint': '\uD83D\uDD17',
        'work-power-energy': '\u26A1', 'work-done': '\uD83D\uDCCF', 'collisions': '\uD83D\uDCA2',
        'conservation-momentum': '\uD83C\uDFB1', 'rotational-motion': '\uD83C\uDFA1', 'center-of-mass': '\u2696\uFE0F',
        'goat-vs-boat': '\uD83D\uDC10', 'inclined-plane-race': '\uD83C\uDFCE\uFE0F', 'atwood-machine': '\uD83E\uDE9C',
        'angular-momentum': '\uD83C\uDF00', 'rolling-vs-rotation': '\uD83D\uDEDE',
        'gravitation': '\uD83C\uDF0D', 'gravity-variation': '\uD83C\uDF11', 'gravity-equilibrium': '\u2696\uFE0F',
        'hookes-law': '\uD83E\uDDEE', 'modulus-elasticity': '\uD83D\uDCCF', 'poissons-ratio': '\u2194\uFE0F',
        'fluid-dynamics': '\uD83C\uDF0A', 'manometer': '\uD83E\uDE7B', 'hydrostatic-paradox': '\uD83E\uDEA3',
        'pascals-law': '\uD83D\uDEE2\uFE0F', 'continuity-equation': '\uD83D\uDEB0', 'venturimeter': '\uD83D\uDD2C',
        'magnus-effect': '\u26BE',
        'thermodynamics': '\uD83C\uDF21\uFE0F', 'calorimetry': '\uD83D\uDD25',
        'shm-waves': '\uD83C\uDF1F', 'pendulum': '\uD83D\uDD70\uFE0F',
        'waves': '\uD83C\uDF0A', 'beats': '\uD83C\uDFB5', 'doppler-effect': '\uD83D\uDE91',
        'electrostatics': '\u26A1', 'coulombs-law': '\uD83D\uDCAB', 'electrostatic-potential': '\u26A1', 'electric-dipole': '\u26A1', 'equilibrium': '\uD83D\uDD0E',
        'current-electricity': '\uD83D\uDD0B', 'magnetism': '\uD83E\uDDF2',
        'emi': '\u2728', 'ac-circuits': '\uD83D\uDCC9',
        'em-waves': '\uD83D\uDCE1', 'ray-optics': '\uD83D\uDD2D', 'wave-optics': '\uD83C\uDF08',
        'modern-physics': '\u2699\uFE0F'
      };

      /* â”€â”€ Map simId -> chapter key â”€â”€ */
      var CHAPTER_MAP = {
        'kinematics': 'kinematics', 'vector-addition': 'kinematics', 'boat-river': 'kinematics', 'graphical-analysis': 'kinematics',
        'newtons-laws': 'newtons-laws', 'static-kinetic-friction': 'newtons-laws', 'pulley-wire-constraint': 'newtons-laws', 'wire-ring-constraint': 'newtons-laws',
        'work-power-energy': 'wpe', 'work-done': 'wpe', 'collisions': 'wpe', 'conservation-momentum': 'wpe',
        'rotational-motion': 'rotational', 'center-of-mass': 'rotational', 'goat-vs-boat': 'rotational', 'inclined-plane-race': 'rotational', 'atwood-machine': 'rotational', 'angular-momentum': 'rotational', 'rolling-vs-rotation': 'rotational',
        'gravitation': 'gravitation', 'gravity-variation': 'gravitation', 'gravity-equilibrium': 'gravitation',
        'hookes-law': 'mechanical-props', 'modulus-elasticity': 'mechanical-props', 'poissons-ratio': 'mechanical-props',
        'fluid-dynamics': 'fluids', 'manometer': 'fluids', 'hydrostatic-paradox': 'fluids', 'pascals-law': 'fluids', 'continuity-equation': 'fluids', 'venturimeter': 'fluids', 'magnus-effect': 'fluids',
        'thermodynamics': 'thermo', 'calorimetry': 'thermo',
        'shm-waves': 'shm', 'pendulum': 'shm',
        'waves': 'waves', 'beats': 'waves', 'doppler-effect': 'waves',
        'electrostatics': 'electrostatics', 'coulombs-law': 'electrostatics', 'electrostatic-potential': 'electrostatics', 'electric-dipole': 'electrostatics', 'equilibrium': 'electrostatics', 'electric-flux': 'electrostatics', 'gauss-law': 'electrostatics',
        'current-electricity': 'current',
        'magnetism': 'magnetism',
        'emi': 'emi', 'ac-circuits': 'ac',
        'em-waves': 'em-waves',
        'ray-optics': 'ray-optics', 'wave-optics': 'wave-optics',
        'modern-physics': 'modern-physics'
      };

      /* â”€â”€ Ordered chapter metadata â”€â”€ */
      var CHAPTER_META = [
        { key: 'kinematics', label: 'Kinematics', color: '#00d4ff' },
        { key: 'newtons-laws', label: "Newton's Laws", color: '#ff6b6b' },
        { key: 'wpe', label: 'Work, Power & Energy', color: '#fbbf24' },
        { key: 'rotational', label: 'Rotational Motion', color: '#a78bfa' },
        { key: 'gravitation', label: 'Gravitation', color: '#34d399' },
        { key: 'mechanical-props', label: 'Mechanical Properties', color: '#f472b6' },
        { key: 'fluids', label: 'Fluid Mechanics', color: '#38bdf8' },
        { key: 'thermo', label: 'KTG & Thermodynamics', color: '#fb923c' },
        { key: 'shm', label: 'Simple Harmonic Motion', color: '#c084fc' },
        { key: 'waves', label: 'Waves', color: '#2dd4bf' },
        { key: 'electrostatics', label: 'Electrostatics & Capacitance', color: '#facc15' },
        { key: 'current', label: 'Current Electricity', color: '#4ade80' },
        { key: 'magnetism', label: 'Moving Charges & Magnetism', color: '#f87171' },
        { key: 'emi', label: 'Electromagnetic Induction', color: '#818cf8' },
        { key: 'ac', label: 'Alternating Current', color: '#22d3ee' },
        { key: 'em-waves', label: 'Electromagnetic Waves', color: '#e879f9' },
        { key: 'ray-optics', label: 'Ray Optics', color: '#fca5a5' },
        { key: 'wave-optics', label: 'Wave Optics', color: '#67e8f9' },
        { key: 'modern-physics', label: 'Modern Physics', color: '#d946ef' }
      ];

      /* â”€â”€ Achievement totals per simulation â”€â”€ */
      var SIM_ACHIEVEMENT_COUNTS = {
        kinematics: 3, pendulum: 3, calorimetry: 3, 'ac-circuits': 3,
        'rotational-motion': 3, 'vector-addition': 3, beats: 3, 'ray-optics': 3,
        'work-power-energy': 3, collisions: 3,
        'hookes-law': 3, 'pulley-wire-constraint': 3, thermodynamics: 3,
        'atwood-machine': 3, 'work-done': 3, 'newtons-laws': 3, manometer: 3,
        'center-of-mass': 3, 'magnus-effect': 3, 'rolling-vs-rotation': 3,
        'current-electricity': 3, 'hydrostatic-paradox': 3, 'em-waves': 3,
        waves: 3, 'shm-waves': 3, 'continuity-equation': 3,
        'conservation-momentum': 3, emi: 3, 'static-kinetic-friction': 3,
        'boat-river': 3, 'gravity-variation': 3, gravitation: 3,
        'poissons-ratio': 3, 'fluid-dynamics': 3, 'doppler-effect': 3,
        'wave-optics': 3, 'goat-vs-boat': 3, venturimeter: 3,
        'angular-momentum': 3, 'pascals-law': 3, 'inclined-plane-race': 3,
        'wire-ring-constraint': 3, magnetism: 3,
        electrostatics: 3, 'coulombs-law': 3, 'electrostatic-potential': 3, 'electric-dipole': 3, 'electric-flux': 3, 'gauss-law': 3, 'modulus-elasticity': 3, 'modern-physics': 3,
        'graphical-analysis': 3, equilibrium: 3, 'gravity-equilibrium': 3
      };

      /* â”€â”€ Display names for every simulation â”€â”€ */
      var SIM_DISPLAY_NAMES = {
        'kinematics': 'Kinematics', 'vector-addition': 'Vector Addition', 'boat-river': 'Boat & River',
        'graphical-analysis': 'Graphical Analysis', 'newtons-laws': "Newton's Laws", 'static-kinetic-friction': 'Static & Kinetic Friction',
        'pulley-wire-constraint': 'Pulley & Wire Constraint', 'wire-ring-constraint': 'Wire & Ring Constraint',
        'work-power-energy': 'Work, Power & Energy', 'work-done': 'Work Done', 'collisions': 'Collisions',
        'conservation-momentum': 'Conservation of Momentum', 'rotational-motion': 'Rotational Motion', 'center-of-mass': 'Center of Mass',
        'goat-vs-boat': 'Goat vs Boat', 'inclined-plane-race': 'Inclined Plane Race', 'atwood-machine': "Atwood's Machine",
        'angular-momentum': 'Angular Momentum', 'rolling-vs-rotation': 'Rolling vs Rotation',
        'gravitation': 'Gravitation', 'gravity-variation': 'Gravity Variation', 'gravity-equilibrium': 'Gravitational Equilibrium',
        'hookes-law': "Hooke's Law", 'modulus-elasticity': 'Modulus of Elasticity', 'poissons-ratio': "Poisson's Ratio",
        'fluid-dynamics': 'Fluid Dynamics', 'manometer': 'Manometer', 'hydrostatic-paradox': 'Hydrostatic Paradox',
        'pascals-law': "Pascal's Law", 'continuity-equation': 'Continuity Equation', 'venturimeter': 'Venturimeter',
        'magnus-effect': 'Magnus Effect',
        'thermodynamics': 'Thermodynamics', 'calorimetry': 'Calorimetry',
        'shm-waves': 'SHM & Waves', 'pendulum': 'Pendulum',
        'waves': 'Waves', 'beats': 'Beats', 'doppler-effect': 'Doppler Effect',
        'electrostatics': 'Electrostatics', 'coulombs-law': "Coulomb's Law", 'electrostatic-potential': 'Electrostatic Potential', 'electric-dipole': 'Electric Dipole', 'electric-flux': 'Electric Flux', 'gauss-law': "Gauss's Law", 'equilibrium': 'Equilibrium',
        'current-electricity': 'Current Electricity', 'magnetism': 'Magnetism',
        'emi': 'Electromagnetic Induction', 'ac-circuits': 'AC Circuits',
        'em-waves': 'EM Waves', 'ray-optics': 'Ray Optics', 'wave-optics': 'Wave Optics',
        'modern-physics': 'Modern Physics'
      };

      /* â”€â”€ Flashcard chapter list â”€â”€ */
      var FC_CHAPTER_GROUPS = [
        { label: 'Grade XI', color: '#00d4ff', chapters: [
          { key: 'kinematics', label: 'Kinematics' },
          { key: 'newtons-laws', label: "Newton's Laws" },
          { key: 'work-power-energy', label: 'Work, Power & Energy' },
          { key: 'gravitation', label: 'Gravitation' },
          { key: 'rotational-motion', label: 'Rotational Motion' },
          { key: 'mechanical-properties', label: 'Mechanical Properties' },
          { key: 'fluid-mechanics', label: 'Fluid Mechanics' },
          { key: 'thermodynamics', label: 'Thermodynamics' },
          { key: 'shm', label: 'Simple Harmonic Motion' },
          { key: 'waves', label: 'Waves' }
        ]},
        { label: 'Grade XII', color: '#facc15', chapters: [
          { key: 'electrostatics', label: 'Electrostatics' },
          { key: 'current-electricity', label: 'Current Electricity' },
          { key: 'magnetism', label: 'Magnetism' },
          { key: 'emi', label: 'Electromagnetic Induction' },
          { key: 'ac-circuits', label: 'AC Circuits' },
          { key: 'ray-optics', label: 'Ray Optics' },
          { key: 'wave-optics', label: 'Wave Optics' },
          { key: 'em-waves', label: 'EM Waves' },
          { key: 'modern-physics', label: 'Modern Physics' }
        ]},
        { label: 'Supplementary', color: '#a78bfa', chapters: [
          { key: 'supplementary', label: 'Vectors, Units, Math & Experiments' }
        ]}
      ];

      /* â”€â”€ State â”€â”€ */
      var currentSort = 'lastVisited';
      var currentFilter = 'all';
      var rawSimData = [];

      function waitForFirebase(cb) {
        if (typeof firebase !== 'undefined' && firebase.auth) { cb(); return; }
        setTimeout(function() { waitForFirebase(cb); }, 100);
      }

      waitForFirebase(function() {
        var auth = firebase.auth();
        var db = firebase.firestore();
        var loginPrompt = document.getElementById('progress-login-prompt');
        var dashboard = document.getElementById('progress-dashboard');
        var progressLoginBtn = document.getElementById('progress-login-btn');

        if (progressLoginBtn) {
          progressLoginBtn.addEventListener('click', function() {
            auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
          });
        }

        auth.onAuthStateChanged(function(user) {
          if (!user) {
            loginPrompt.style.display = 'block';
            dashboard.style.display = 'none';
            return;
          }
          loginPrompt.style.display = 'none';
          dashboard.style.display = 'block';
          // Show student name if available
          db.collection('users').doc(user.uid).get().then(function(doc) {
            var data = doc.exists ? doc.data() : {};
            if (data.studentName) {
              var nameWrap = document.getElementById('progress-student-name');
              document.getElementById('progress-sname').textContent = data.studentName;
              nameWrap.style.display = 'block';
              if (data.batchCode) {
                var batchEl = document.getElementById('progress-batch');
                batchEl.textContent = data.batchCode;
                batchEl.style.display = 'inline';
              }
            }
          });
          loadProgress(user.uid);
        });

        function formatTime(seconds) {
          if (seconds < 60) return seconds + 's';
          if (seconds < 3600) return Math.floor(seconds / 60) + 'm ' + (seconds % 60) + 's';
          return Math.floor(seconds / 3600) + 'h ' + Math.floor((seconds % 3600) / 60) + 'm';
        }

        function countAchievements(achMap) {
          if (!achMap) return 0;
          var count = 0;
          for (var key in achMap) {
            if (achMap[key] && achMap[key].unlocked) count++;
          }
          return count;
        }

        function formatShortDate(dateObj) {
          var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
          return months[dateObj.getMonth()] + ' ' + dateObj.getDate();
        }

        function getTrophy(unlocked, total) {
          if (total === 0 || unlocked === 0) return '';
          if (unlocked === total) return '\uD83E\uDD47'; // gold
          if (unlocked >= Math.ceil(total * 2 / 3)) return '\uD83E\uDD48'; // silver
          return '\uD83E\uDD49'; // bronze
        }

        // Reset all achievements button
        var resetBtn = document.getElementById('reset-ach-btn');
        var resetWrap = document.getElementById('reset-ach-wrap');
        var currentUid = null;

        resetBtn.addEventListener('click', function() {
          if (!currentUid) return;
          if (!confirm('Are you sure you want to reset ALL achievements across every simulation? This cannot be undone.')) return;
          resetBtn.textContent = 'Resetting...';
          resetBtn.disabled = true;
          db.collection('users').doc(currentUid).collection('simulations').get()
            .then(function(snapshot) {
              var batch = db.batch();
              snapshot.forEach(function(doc) {
                batch.update(doc.ref, { achievements: firebase.firestore.FieldValue.delete() });
              });
              return batch.commit();
            })
            .then(function() {
              resetBtn.textContent = 'Reset All Achievements';
              resetBtn.disabled = false;
              loadProgress(currentUid);
            })
            .catch(function() {
              resetBtn.textContent = 'Reset All Achievements';
              resetBtn.disabled = false;
              alert('Something went wrong. Please try again.');
            });
        });

        // Tab switching
        var tabs = document.querySelectorAll('.progress-tab');
        tabs.forEach(function(tab) {
          tab.addEventListener('click', function() {
            tabs.forEach(function(t) { t.classList.remove('active'); });
            tab.classList.add('active');
            document.querySelectorAll('.progress-tab-content').forEach(function(c) { c.classList.remove('active'); });
            document.getElementById(tab.getAttribute('data-target')).classList.add('active');
          });
        });

        // Sort/filter button handlers
        document.querySelectorAll('.pc-btn[data-sort]').forEach(function(btn) {
          btn.addEventListener('click', function() {
            document.querySelectorAll('.pc-btn[data-sort]').forEach(function(b) { b.classList.remove('active'); });
            btn.classList.add('active');
            currentSort = btn.getAttribute('data-sort');
            renderSimList();
          });
        });
        document.querySelectorAll('.pc-btn[data-filter]').forEach(function(btn) {
          btn.addEventListener('click', function() {
            document.querySelectorAll('.pc-btn[data-filter]').forEach(function(b) { b.classList.remove('active'); });
            btn.classList.add('active');
            currentFilter = btn.getAttribute('data-filter');
            renderSimList();
          });
        });

        function loadProgress(uid) {
          currentUid = uid;
          resetWrap.style.display = '';
          db.collection('users').doc(uid).collection('simulations')
            .get()
            .then(function(snapshot) {
              var noData = document.getElementById('no-data-msg');
              noData.style.display = 'none';

              rawSimData = [];
              var visitedIds = {};

              snapshot.forEach(function(doc) {
                var d = doc.data();
                var achUnlocked = countAchievements(d.achievements);
                var achTotal = SIM_ACHIEVEMENT_COUNTS[doc.id] || 0;
                var lastDate = d.lastVisited ? d.lastVisited.toDate() : null;
                visitedIds[doc.id] = true;
                rawSimData.push({
                  id: doc.id,
                  name: SIM_DISPLAY_NAMES[doc.id] || d.name || doc.id,
                  visits: d.visitCount || 0,
                  time: d.totalTimeSpent || 0,
                  lastVisited: lastDate,
                  achUnlocked: achUnlocked,
                  achTotal: achTotal,
                  achievements: d.achievements || {},
                  mastered: achTotal > 0 && achUnlocked === achTotal
                });
              });

              // Add all unvisited simulations
              Object.keys(CHAPTER_MAP).forEach(function(simId) {
                if (!visitedIds[simId]) {
                  var achTotal = SIM_ACHIEVEMENT_COUNTS[simId] || 0;
                  rawSimData.push({
                    id: simId,
                    name: SIM_DISPLAY_NAMES[simId] || simId,
                    visits: 0,
                    time: 0,
                    lastVisited: null,
                    achUnlocked: 0,
                    achTotal: achTotal,
                    achievements: {},
                    mastered: false
                  });
                }
              });

              renderSummaryCards();
              renderSimList();
            });
          loadFlashcardProgress(uid);
        }

        function renderSummaryCards() {
          var el = document.getElementById('summary-cards');
          var totalVisits = 0, totalTime = 0, totalDiscoveries = 0, simsVisited = 0;
          rawSimData.forEach(function(s) {
            totalVisits += s.visits;
            totalTime += s.time;
            totalDiscoveries += s.achUnlocked;
            if (s.visits > 0) simsVisited++;
          });

          el.innerHTML =
            '<div class="summary-card sc-visited"><div class="sc-icon">\uD83E\uDDED</div><div class="summary-num">' + simsVisited + '</div><div class="summary-label">Sims Visited</div></div>' +
            '<div class="summary-card sc-total"><div class="sc-icon">\uD83D\uDC41\uFE0F</div><div class="summary-num">' + totalVisits + '</div><div class="summary-label">Total Visits</div></div>' +
            '<div class="summary-card sc-time"><div class="sc-icon">\u23F1\uFE0F</div><div class="summary-num">' + formatTime(totalTime) + '</div><div class="summary-label">Study Time</div></div>' +
            '<div class="summary-card sc-discoveries"><div class="sc-icon">\uD83C\uDFC6</div><div class="summary-num">' + totalDiscoveries + '</div><div class="summary-label">Discoveries</div></div>';
        }

        /* â”€â”€ Flashcard progress â”€â”€ */
        var fcCardCounts = {}; // cached total card counts per chapter

        function loadFlashcardProgress(uid) {
          var list = document.getElementById('flashcard-progress-list');
          var noMsg = document.getElementById('no-flashcard-msg');
          list.innerHTML = '';

          // Fetch all flashcard docs from Firebase
          db.collection('users').doc(uid).collection('flashcards').get()
            .then(function(snapshot) {
              var fbData = {};
              snapshot.forEach(function(doc) {
                fbData[doc.id] = doc.data().cards || {};
              });

              // Fetch total card counts for all chapters, then render
              var allChapterKeys = [];
              FC_CHAPTER_GROUPS.forEach(function(g) {
                g.chapters.forEach(function(ch) { allChapterKeys.push(ch.key); });
              });

              var fetches = allChapterKeys.map(function(key) {
                if (fcCardCounts[key] !== undefined) return Promise.resolve();
                return fetch('cards/' + key + '.json')
                  .then(function(r) { return r.ok ? r.json() : []; })
                  .then(function(data) { fcCardCounts[key] = Array.isArray(data) ? data.length : 0; })
                  .catch(function() { fcCardCounts[key] = 0; });
              });

              Promise.all(fetches).then(function() {
                renderFlashcardList(list, fbData);
                var hasAny = false;
                for (var k in fbData) { if (Object.keys(fbData[k]).length > 0) { hasAny = true; break; } }
                noMsg.style.display = hasAny || allChapterKeys.length > 0 ? 'none' : 'block';
              });
            })
            .catch(function() {
              // Offline â€” try localStorage
              var fbData = {};
              FC_CHAPTER_GROUPS.forEach(function(g) {
                g.chapters.forEach(function(ch) {
                  try {
                    var raw = localStorage.getItem('ae-flashcards-' + ch.key);
                    if (raw) fbData[ch.key] = JSON.parse(raw);
                  } catch(e) {}
                });
              });

              var allChapterKeys = [];
              FC_CHAPTER_GROUPS.forEach(function(g) {
                g.chapters.forEach(function(ch) { allChapterKeys.push(ch.key); });
              });

              var fetches = allChapterKeys.map(function(key) {
                if (fcCardCounts[key] !== undefined) return Promise.resolve();
                return fetch('cards/' + key + '.json')
                  .then(function(r) { return r.ok ? r.json() : []; })
                  .then(function(data) { fcCardCounts[key] = Array.isArray(data) ? data.length : 0; })
                  .catch(function() { fcCardCounts[key] = 0; });
              });

              Promise.all(fetches).then(function() {
                renderFlashcardList(list, fbData);
              });
            });
        }

        function renderFlashcardList(list, fbData) {
          list.innerHTML = '';
          var now = Date.now();

          FC_CHAPTER_GROUPS.forEach(function(group) {
            var section = document.createElement('div');
            section.className = 'progress-chapter';

            var toggle = document.createElement('button');
            toggle.className = 'pch-toggle collapsed';
            toggle.innerHTML =
              '<span class="pch-bar" style="background:' + group.color + '"></span>' +
              '<span class="pch-label">' + group.label + '</span>' +
              '<span class="pch-count">' + group.chapters.length + ' chapter' + (group.chapters.length !== 1 ? 's' : '') + '</span>' +
              '<span class="pch-arrow">\u25BC</span>';

            var rows = document.createElement('div');
            rows.className = 'progress-chapter-rows collapsed';

            group.chapters.forEach(function(ch) {
              var cards = fbData[ch.key] || {};
              var total = fcCardCounts[ch.key] || 0;
              var studied = Object.keys(cards).length;
              var mastered = 0, due = 0;

              for (var cid in cards) {
                var c = cards[cid];
                if ((c.interval || 0) >= 21) mastered++;
                if ((c.nextReview || 0) <= now) due++;
              }

              var pct = total > 0 ? Math.round((studied / total) * 100) : 0;

              var row = document.createElement('a');
              row.href = 'flashcards.html';
              row.className = 'progress-row';

              row.innerHTML =
                '<span class="pr-name">' + ch.label + '</span>' +
                '<span class="pr-stat">' + studied + '/' + total + ' studied</span>' +
                '<span class="pr-stat">' + mastered + ' mastered</span>' +
                '<span class="pr-stat">' + due + ' due</span>' +
                '<span class="pr-ach">' +
                  '<span class="pr-ach-text">' + pct + '%</span>' +
                  '<span class="pr-ach-bar"><span class="pr-ach-fill" style="width:' + pct + '%"></span></span>' +
                '</span>';

              rows.appendChild(row);
            });

            toggle.addEventListener('click', function() {
              rows.classList.toggle('collapsed');
              toggle.classList.toggle('collapsed');
            });

            section.appendChild(toggle);
            section.appendChild(rows);
            list.appendChild(section);
          });
        }

        function renderSimList() {
          var list = document.getElementById('progress-list');
          var headerRow = document.getElementById('progress-header-row');
          list.innerHTML = '';

          // Filter
          var filtered = rawSimData.filter(function(s) {
            if (currentFilter === 'mastered') return s.mastered;
            if (currentFilter === 'incomplete') return !s.mastered;
            return true;
          });

          // Sort
          var sorted = filtered.slice();
          if (currentSort === 'lastVisited') {
            sorted.sort(function(a, b) {
              if (!a.lastVisited) return 1;
              if (!b.lastVisited) return -1;
              return b.lastVisited - a.lastVisited;
            });
          } else if (currentSort === 'mostVisited') {
            sorted.sort(function(a, b) { return b.visits - a.visits; });
          } else if (currentSort === 'mostTime') {
            sorted.sort(function(a, b) { return b.time - a.time; });
          } else if (currentSort === 'completion') {
            sorted.sort(function(a, b) {
              var pctA = a.achTotal > 0 ? a.achUnlocked / a.achTotal : 0;
              var pctB = b.achTotal > 0 ? b.achUnlocked / b.achTotal : 0;
              return pctB - pctA;
            });
          }

          // Grouped view for "Last Visited" sort, flat for others
          if (currentSort === 'lastVisited') {
            headerRow.style.display = 'none';
            renderGrouped(list, sorted);
          } else {
            headerRow.style.display = 'flex';
            renderFlat(list, sorted);
          }
        }

        function renderGrouped(list, data) {
          // Group sims by chapter
          var groups = {};
          data.forEach(function(s) {
            var ch = CHAPTER_MAP[s.id] || 'other';
            if (!groups[ch]) groups[ch] = [];
            groups[ch].push(s);
          });

          CHAPTER_META.forEach(function(ch) {
            var sims = groups[ch.key];
            if (!sims || sims.length === 0) return;

            var section = document.createElement('div');
            section.className = 'progress-chapter';

            var toggle = document.createElement('button');
            toggle.className = 'pch-toggle collapsed';
            toggle.innerHTML =
              '<span class="pch-bar" style="background:' + ch.color + '"></span>' +
              '<span class="pch-label">' + ch.label + '</span>' +
              '<span class="pch-count">' + sims.length + ' sim' + (sims.length !== 1 ? 's' : '') + '</span>' +
              '<span class="pch-arrow">\u25BC</span>';

            var rows = document.createElement('div');
            rows.className = 'progress-chapter-rows collapsed';

            sims.forEach(function(s) {
              rows.appendChild(buildRow(s));
            });

            toggle.addEventListener('click', function() {
              rows.classList.toggle('collapsed');
              toggle.classList.toggle('collapsed');
            });

            section.appendChild(toggle);
            section.appendChild(rows);
            list.appendChild(section);
          });
        }

        function renderFlat(list, data) {
          data.forEach(function(s) {
            list.appendChild(buildRow(s));
          });
        }

        function buildRow(s) {
          var lastDate = s.lastVisited ? formatShortDate(s.lastVisited) : '\u2014';
          var pct = s.achTotal > 0 ? Math.round(s.achUnlocked / s.achTotal * 100) : 0;
          var trophy = getTrophy(s.achUnlocked, s.achTotal);

          var row = document.createElement('a');
          row.href = 'simulations/' + s.id + '.html';
          row.className = 'progress-row' + (s.mastered ? ' mastered' : '');

          var visitLabel = s.visits === 1 ? '1 visit' : s.visits + ' visits';

          row.innerHTML =
            '<span class="pr-name">' + s.name + '</span>' +
            (trophy ? '<span class="pr-trophy">' + trophy + '</span>' : '') +
            '<span class="pr-stat">' + visitLabel + '</span>' +
            '<span class="pr-stat">' + formatTime(s.time) + '</span>' +
            '<span class="pr-stat">' + lastDate + '</span>' +
            (s.achTotal > 0
              ? '<span class="pr-ach" data-sim-id="' + s.id + '">' +
                  '<span class="pr-ach-text">' + s.achUnlocked + '/' + s.achTotal + '</span>' +
                  '<span class="pr-ach-bar"><span class="pr-ach-fill" style="width:' + pct + '%"></span></span>' +
                '</span>'
              : '') +
            '<div class="pr-ach-detail" style="display:none;"></div>';

          // Achievement area click -> expand detail (prevent navigation)
          var achEl = row.querySelector('.pr-ach');
          if (achEl) {
            achEl.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              toggleAchDetail(row, s);
            });
          }

          return row;
        }

        function toggleAchDetail(row, s) {
          var detail = row.querySelector('.pr-ach-detail');
          if (!detail) return;

          if (detail.style.display !== 'none') {
            detail.style.display = 'none';
            return;
          }

          // Build detail content from SIM_ACHIEVEMENTS_CONFIG
          var config = (typeof window.SIM_ACHIEVEMENTS_CONFIG !== 'undefined') ? window.SIM_ACHIEVEMENTS_CONFIG[s.id] : null;
          if (!config) {
            detail.innerHTML = '<div class="pad-item">No achievement details available</div>';
            detail.style.display = '';
            return;
          }

          var html = '';
          config.forEach(function(ach) {
            var isUnlocked = s.achievements && s.achievements[ach.id] && s.achievements[ach.id].unlocked;
            html += '<div class="pad-item' + (isUnlocked ? ' unlocked' : '') + '">' +
              '<span class="pad-icon">' + (ach.icon || '\uD83C\uDFC6') + '</span>' +
              '<span class="pad-text">' +
                '<span class="pad-title">' + ach.title + '</span>' +
                '<span class="pad-desc">' + ach.description + '</span>' +
              '</span>' +
              '<span class="pad-status">' + (isUnlocked ? '\u2705' : '\uD83D\uDD12') + '</span>' +
            '</div>';
          });

          detail.innerHTML = html;
          detail.style.display = '';
        }
      });
    })();
  </script>
<script>if("serviceWorker" in navigator){navigator.serviceWorker.register("/sw.js");}</script>
</body>
</html>
