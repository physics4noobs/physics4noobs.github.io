<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Progress | Axomiya Engineer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Delius&family=Nova+Square&family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&family=Andika:wght@400;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/achievements.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ”¬</text></svg>">
  <script src="js/theme.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script defer src="js/firebase-config.js"></script>
  <script defer src="js/auth.js"></script>
</head>
<body>

  <div class="splash-screen" id="splash"><div class="splash-pendulum"><div class="sp-mount"></div><div class="sp-pivot"></div><div class="sp-arm"><div class="sp-rod"></div><div class="sp-bob"><div class="sp-glow"></div></div></div></div><div class="splash-logo">Axomiya Engineer</div><div class="splash-tagline">Lets Make Physics Fun</div></div>
<div class="bg-grid"></div>
  <canvas id="particles-canvas"></canvas>

  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="nav-logo" id="nav-logo">
        <div class="logo-icon">
          <div class="logo-pendulum">
            <div class="pendulum-pivot"></div>
            <div class="pendulum-arm">
              <div class="pendulum-rod"></div>
              <div class="pendulum-bob"></div>
            </div>
          </div>
        </div>
        <div class="logo-text">
          <span class="brand-name">Axomiya Engineer</span>
          <span class="brand-tag">LETS MAKE PHYSICS FUN</span>
        </div>
      </a>

      <div class="nav-links">
        <div class="nav-item">
          <a href="index.html" class="nav-link">Home</a>
        </div>
        <div class="nav-item">
          <a href="about.html" class="nav-link">About Me</a>
        </div>
        <div class="nav-item"><a href="chapters.html" class="nav-link">Chapters</a></div>        <div class="nav-item">
          <a href="simulations.html" class="nav-link">Simulations</a>
        </div>
        <div class="nav-item">
          <a href="tests.html" class="nav-link">Tests</a>
        </div>
        <div class="nav-item">
          <a href="flashcards.html" class="nav-link">Flashcards</a>
        </div>
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme"></button>

        <button class="auth-btn" id="auth-login-btn">
          <svg class="google-icon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Sign in
        </button>

        <div class="user-menu nav-item" id="auth-user-menu" style="display:none;">
          <img class="user-avatar" id="auth-user-avatar" src="" alt="User">
          <span class="user-name" id="auth-user-name"></span>
          <div class="dropdown">
            <a href="progress.html"><div class="dd-icon">&#128200;</div> My Progress</a>
            <div class="dropdown-divider"></div>
            <a href="#" id="auth-logout-btn"><div class="dd-icon">&#128682;</div> Sign Out</a>
          </div>
        </div>

        <a href="#contact" class="nav-cta">Contact Me</a>
      </div>

      <button class="nav-toggle" aria-label="Menu">
        <span></span><span></span><span></span>
      </button>
    </div>
  </nav>
  <script>
    (function(){
      var s=document.getElementById('splash');
      if(sessionStorage.getItem('ae-splash')){s.style.display='none';}
      else{
        sessionStorage.setItem('ae-splash','1');setTimeout(function(){s.classList.add('fade-out');},2200);setTimeout(function(){s.style.display='none';},2700);
      }
    })();
  </script>

  <div class="page-header">
    <h1>My <span class="text-gradient">Progress</span></h1>
    <p>Track your simulation usage and study time</p>
  </div>

  <section class="section" style="padding-top: 20px;">
    <div class="container">

      <div id="progress-login-prompt" class="login-prompt" style="display:none;">
        <h2>Sign in to Track Progress</h2>
        <p>Log in with Google to see your simulation history, visit counts, and time spent studying.</p>
        <button class="auth-btn" id="progress-login-btn">
          <svg class="google-icon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Sign in with Google
        </button>
      </div>

      <div id="progress-dashboard" style="display:none;">
        <div class="summary-cards" id="summary-cards"></div>
        <h2 style="font-family: var(--font-display); font-size: 1.3rem; margin-bottom: 24px; letter-spacing: 1px;">Simulation History</h2>
        <div class="progress-grid" id="progress-grid"></div>
        <p id="no-data-msg" style="text-align:center; color:var(--text-muted); display:none; margin-top: 40px;">
          No simulations visited yet. <a href="simulations.html" style="color:var(--color-primary);">Start exploring!</a>
        </p>
        <div id="reset-ach-wrap" style="display:none; margin-top: 40px; text-align: center;">
          <button id="reset-ach-btn" style="padding: 10px 24px; font-family: var(--font-body); font-size: 0.9rem; font-weight: 600; color: #ff4a6e; background: rgba(255,74,110,0.08); border: 1px solid rgba(255,74,110,0.3); border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;">Reset All Achievements</button>
        </div>
      </div>

    </div>
  </section>

  <footer class="footer">
    <div class="footer-grid">
      <div class="footer-brand">
        <a href="index.html" class="nav-logo" style="margin-bottom: 16px;">
          <div class="logo-icon">
            <div class="logo-pendulum">
              <div class="pendulum-pivot"></div>
              <div class="pendulum-arm">
                <div class="pendulum-rod"></div>
                <div class="pendulum-bob"></div>
              </div>
            </div>
          </div>
          <div class="logo-text">
            <span class="brand-name">Axomiya Engineer</span>
            <span class="brand-tag">LETS MAKE PHYSICS FUN</span>
          </div>
        </a>
        <p>Transforming physics education through interactive simulations, crystal-clear concepts, and a passion that ignites curiosity.</p>
      </div>
      <div class="footer-col">
        <h4>Resources</h4>
        <a href="chapters.html">Chapters</a>
        
        
        <a href="simulations.html">Simulations</a>
      </div>
      <div class="footer-col">
        <h4>Grade XI</h4>
        <a href="chapters.html#grade-xi">Kinematics</a>
        <a href="chapters.html#grade-xi">Newton's Laws</a>
        <a href="chapters.html#grade-xi">Work, Power, Energy</a>
        <a href="chapters.html#grade-xi">Thermodynamics</a>
        <a href="chapters.html#grade-xi">SHM & Waves</a>
      </div>
      <div class="footer-col">
        <h4>Grade XII</h4>
        <a href="chapters.html#grade-xii">Electrostatics</a>
        <a href="chapters.html#grade-xii">Current Electricity</a>
        <a href="chapters.html#grade-xii">Magnetism</a>
        <a href="chapters.html#grade-xii">Ray Optics</a>
        <a href="chapters.html#grade-xii">Modern Physics</a>
      </div>
    </div>
    <div class="footer-bottom">
      <span>&copy; 2025 Axomiya Engineer &mdash; Sankaracharya Dutta. All rights reserved.</span>
      <span>Built with &#9889; for Physics lovers</span>
    </div>
  </footer>

  <script src="js/main.js"></script>
  <script>
    (function() {
      // Achievement totals per simulation
      var SIM_ACHIEVEMENT_COUNTS = {
        kinematics: 3, pendulum: 3, calorimetry: 3, 'ac-circuits': 3,
        'rotational-motion': 3, 'vector-addition': 3, beats: 3, 'ray-optics': 3,
        'work-power-energy': 3, collisions: 3,
        'hookes-law': 3, 'pulley-wire-constraint': 3, thermodynamics: 3,
        'atwood-machine': 3, 'work-done': 3, 'newtons-laws': 3, manometer: 3,
        'center-of-mass': 3, 'magnus-effect': 3, 'rolling-vs-rotation': 3,
        'current-electricity': 3, 'hydrostatic-paradox': 3, 'em-waves': 3,
        waves: 3, 'shm-waves': 3, 'continuity-equation': 3,
        'conservation-momentum': 3, emi: 3, 'static-kinetic-friction': 3,
        'boat-river': 3, 'gravity-variation': 3, gravitation: 3,
        'poissons-ratio': 3, 'fluid-dynamics': 3, 'doppler-effect': 3,
        'wave-optics': 3, 'goat-vs-boat': 3, venturimeter: 3,
        'angular-momentum': 3, 'pascals-law': 3, 'inclined-plane-race': 3,
        'wire-ring-constraint': 3, magnetism: 3,
        electrostatics: 3, 'modulus-elasticity': 3, 'modern-physics': 3,
        'graphical-analysis': 3
      };

      function waitForFirebase(cb) {
        if (typeof firebase !== 'undefined' && firebase.auth) { cb(); return; }
        setTimeout(function() { waitForFirebase(cb); }, 100);
      }

      waitForFirebase(function() {
        var auth = firebase.auth();
        var db = firebase.firestore();
        var loginPrompt = document.getElementById('progress-login-prompt');
        var dashboard = document.getElementById('progress-dashboard');
        var progressLoginBtn = document.getElementById('progress-login-btn');

        if (progressLoginBtn) {
          progressLoginBtn.addEventListener('click', function() {
            auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
          });
        }

        auth.onAuthStateChanged(function(user) {
          if (!user) {
            loginPrompt.style.display = 'block';
            dashboard.style.display = 'none';
            return;
          }
          loginPrompt.style.display = 'none';
          dashboard.style.display = 'block';
          loadProgress(user.uid);
        });

        function formatTime(seconds) {
          if (seconds < 60) return seconds + 's';
          if (seconds < 3600) return Math.floor(seconds / 60) + 'm ' + (seconds % 60) + 's';
          return Math.floor(seconds / 3600) + 'h ' + Math.floor((seconds % 3600) / 60) + 'm';
        }

        function countAchievements(achMap) {
          if (!achMap) return 0;
          var count = 0;
          for (var key in achMap) {
            if (achMap[key] && achMap[key].unlocked) count++;
          }
          return count;
        }

        // Reset all achievements button
        var resetBtn = document.getElementById('reset-ach-btn');
        var resetWrap = document.getElementById('reset-ach-wrap');
        var currentUid = null;

        resetBtn.addEventListener('click', function() {
          if (!currentUid) return;
          if (!confirm('Are you sure you want to reset ALL achievements across every simulation? This cannot be undone.')) return;
          resetBtn.textContent = 'Resetting...';
          resetBtn.disabled = true;
          db.collection('users').doc(currentUid).collection('simulations').get()
            .then(function(snapshot) {
              var batch = db.batch();
              snapshot.forEach(function(doc) {
                batch.update(doc.ref, { achievements: firebase.firestore.FieldValue.delete() });
              });
              return batch.commit();
            })
            .then(function() {
              resetBtn.textContent = 'Reset All Achievements';
              resetBtn.disabled = false;
              loadProgress(currentUid);
            })
            .catch(function() {
              resetBtn.textContent = 'Reset All Achievements';
              resetBtn.disabled = false;
              alert('Something went wrong. Please try again.');
            });
        });

        function loadProgress(uid) {
          currentUid = uid;
          resetWrap.style.display = '';
          db.collection('users').doc(uid).collection('simulations')
            .orderBy('lastVisited', 'desc')
            .get()
            .then(function(snapshot) {
              var grid = document.getElementById('progress-grid');
              var summaryEl = document.getElementById('summary-cards');
              var noData = document.getElementById('no-data-msg');
              grid.innerHTML = '';
              summaryEl.innerHTML = '';

              if (snapshot.empty) {
                noData.style.display = 'block';
                return;
              }
              noData.style.display = 'none';

              var totalVisits = 0;
              var totalTime = 0;
              var totalDiscoveries = 0;
              var mostPracticed = { name: '', visits: 0 };

              snapshot.forEach(function(doc) {
                var d = doc.data();
                totalVisits += d.visitCount || 0;
                totalTime += d.totalTimeSpent || 0;
                if ((d.visitCount || 0) > mostPracticed.visits) {
                  mostPracticed = { name: d.name || doc.id, visits: d.visitCount };
                }

                var achUnlocked = countAchievements(d.achievements);
                var achTotal = SIM_ACHIEVEMENT_COUNTS[doc.id] || 0;
                totalDiscoveries += achUnlocked;

                var lastDate = d.lastVisited ? d.lastVisited.toDate().toLocaleDateString() : 'N/A';
                var card = document.createElement('div');
                card.className = 'progress-card';

                var achHtml = '';
                var expertHtml = '';
                if (achTotal > 0) {
                  var pct = Math.round(achUnlocked / achTotal * 100);
                  var isComplete = achUnlocked === achTotal;
                  if (isComplete) {
                    card.className += ' mastered';
                    expertHtml =
                      '<div class="progress-expert-badge">' +
                        '<span class="progress-expert-star">&#11088;</span>' +
                        '<span class="progress-expert-label">Expert</span>' +
                      '</div>';
                  }
                  achHtml =
                    '<div class="progress-ach-row">' +
                      (isComplete ? '<span class="progress-ach-trophy">&#127942;</span>' : '') +
                      '<span class="progress-ach-text">' + achUnlocked + '/' + achTotal + ' Discoveries</span>' +
                      '<div class="progress-ach-bar"><div class="progress-ach-fill" style="width:' + pct + '%"></div></div>' +
                    '</div>';
                }

                card.innerHTML =
                  expertHtml +
                  '<h3>' + (d.name || doc.id) + '</h3>' +
                  '<div class="progress-stat"><span>Visits</span><span class="stat-value">' + (d.visitCount || 0) + '</span></div>' +
                  '<div class="progress-stat"><span>Time Spent</span><span class="stat-value">' + formatTime(d.totalTimeSpent || 0) + '</span></div>' +
                  '<div class="progress-stat"><span>Last Visited</span><span class="stat-value">' + lastDate + '</span></div>' +
                  achHtml;
                grid.appendChild(card);
              });

              summaryEl.innerHTML =
                '<div class="summary-card"><div class="summary-num">' + snapshot.size + '</div><div class="summary-label">Simulations Visited</div></div>' +
                '<div class="summary-card"><div class="summary-num">' + totalVisits + '</div><div class="summary-label">Total Visits</div></div>' +
                '<div class="summary-card"><div class="summary-num">' + formatTime(totalTime) + '</div><div class="summary-label">Total Study Time</div></div>' +
                '<div class="summary-card"><div class="summary-num">' + totalDiscoveries + '</div><div class="summary-label">Total Discoveries</div></div>';
            });
        }
      });
    })();
  </script>
</body>
</html>
